WORKING-STORAGE SECTION.
01  WS-SQLCODE    PIC -9(03) VALUE ZERO.
01  WS-INPUT.
    88  END-OF-DATA   VALUE 'XXXXXXXXXXXXX'.
    03  WS-LOC    PIC X(03).
    03  WS-PER    PIC 9(02) OCCURS 5 TIMES.
01  WS-EARN    PIC 9(05)V99 VALUE ZERO.
01  WS-DEDN    PIC 9(05)V99 VALUE ZERO.
01  WS-SAL     PIC 9(05)V99 VALUE ZERO.
    EXEC SQL
        INCLUDE EMPLOYEE
    END-EXEC
    EXEC SQL
        INCLUDE SQLCA
    END-EXEC
    EXEC SQL
        DECLARE EMP_CUR CURSOR FOR
        SELECT EMP_ID, EMP_NAME, EMP_EARN, EMP_DEDN
        FROM  Tnn_EMPLOYEE_TABLE
        WHERE EMP_LOC = :WS-LOC
        FOR UPDATE OF EMP_EARN, EMP_DEDN
    END-EXEC.
01  WS-TABLE-FLAG PIC X(01) VALUE 'N'.
    88  END-OF-ROWS         VALUE 'Y'.
PROCEDURE DIVISION.
MAIN-PARA.
    PERFORM INIT-PARA
    PERFORM PROCESS-PARA  UNTIL  END-OF-DATA
    PERFORM END-PARA
    STOP RUN.
INIT-PARA.
    OPEN OUTPUT REPORT-FILE.
    ACCEPT WS-LOC
    PERFORM OPEN-CURSOR.
PROCESS-PARA.
    PERFORM PROCESS-LOCATION  UNTIL  END-OF-ROWS
    MOVE 'N' TO WS-TABLE-FLAG
    MOVE ZERO TO WS-COUNT
    ACCEPT WS-LOC
    IF NOT END-OF-DATA
        PERFORM GET-LOCATION
        PERFORM OPEN-CURSOR
    END-IF.
PROCESS-LOCATION.
    PERFORM FETCH-PARA.
    EVALUATE SQLCODE
        WHEN ZERO
ADD 1 TO WS-COUNT
           PERFORM PROCESS-ROW
        WHEN 100
           MOVE 'Y' TO WS-TABLE-FLAG
           IF WS-COUNT = ZERO
              DISPLAY 'NO EMPLOYEES FOR LOC ', WS-LOC
           END-IF
           PERFORM CLOSE-CURSOR
        WHEN OTHER
           DISPLAY 'UNKNOWN ERROR'
    END-EVALUATE.
FETCH-PARA.
    EXEC SQL
        FETCH EMP_CUR INTO
        :EMP-ID, :EMP-NAME, :EMP-EARN, :EMP-DEDN
    END-EXEC.
OPEN-CURSOR.
    EXEC SQL
        OPEN EMP_CUR
    END-EXEC.
PROCESS-ROW.
    Calculate the New Earn & Dedn based on the Designation
    Update the Employee Table
CLOSE-PARA.
    EXEC SQL
        CLOSE EMP_CUR
    END-EXEC.
END-PARA.
    DISPLAY 'END OF DATA, BYE, BYE!!'
    CLOSE REPORT-FILE.
++++++++++++++++++++++
